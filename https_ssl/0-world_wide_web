#!/usr/bin/env bash
# Displays the A record type and destination IP for specific subdomains using dig and awk.

# Shellcheck ignore: SC2154 is ignored as per task requirements for unassigned variables in the awk block
# Shellcheck ignore: SC2086 is ignored as per task requirements for unquoted variables in the dig command
audit_subdomain() {
    local DOMAIN="$1"
    local SUB_PREFIX="$2"
    local FULL_SUBDOMAIN="${SUB_PREFIX}.${DOMAIN}"

    # Use awk variable 'sub_name' instead of 'sub' to avoid conflict with the built-in awk function sub().
    dig "$FULL_SUBDOMAIN" | awk -v sub_name="$SUB_PREFIX" '/^;; ANSWER SECTION:/ {
        # Set a flag to process lines only within the answer section
        in_answer=1
    }
    # Check if we are in the answer section AND the record type ($5) is 'A'
    in_answer && $5 == "A" {
        print "The subdomain " sub_name " is a " $5 " record and points to " $6
        # Exit awk immediately after finding the A record
        exit
    }'
}

# --- Main Logic ---

DOMAIN=$1
SUBDOMAIN=$2
SUBDOMAINS=("www" "lb-01" "web-01" "web-02")

# Check 1: If the user did not provide the domain, display usage and exit.
if [ -z "$DOMAIN" ]; then
    echo "Usage: 0-world_wide_web DOMAIN_NAME [SUBDOMAIN]"
    exit 1
fi

# Check 2: If only the domain argument is provided (SUBDOMAIN is empty)
if [ -z "$SUBDOMAIN" ]; then
    # Iterate through the required subdomains in the specified order
    for SUB in "${SUBDOMAINS[@]}"; do
        audit_subdomain "$DOMAIN" "$SUB"
    done
# Check 3: Both domain and specific subdomain arguments are provided
else
    audit_subdomain "$DOMAIN" "$SUBDOMAIN"
fi
